<!DOCTYPE html>
<!-- from http://bl.ocks.org/mbostock/4339083
and http://bl.ocks.org/mbostock/4063550

!-->
<html>
<head>
<meta charset="utf-8">
<style>
.timelinepoint {
  font-size: 12px;
}

.eebevent {
  font-size: 14px;
}
.eebclass {
  font-size: 14px;
}
.keycode {
  width: 12px;
  height: 12px;
  margin: auto;
  display: inline-block;
  vertical-align: middle;
  border-radius: 2px;
  border: 1px solid black;
}
</style>

<link rel="stylesheet" href="jquery/jquery-ui-1.13.2.custom/jquery-ui.theme.css"> 
<script src="jquery/jquery.v2.min.js"></script>
<script src="jquery/jquery-ui-1.13.2.custom/jquery-ui.min.js"> </script>

<script>
  $( function() {
    $( "#accordion" ).accordion({
      collapsible: true
    });
  } );
</script>
</head>
<body>
<script src="d3/d3.v7.min.js"></script>
<script src="./data.js"> </script>
<p id="help"></p>

<!-- If you change colors, outcome_col!
var outcome_col = [[ "#FFF", "#FAA", "#F77", "#F00", ],
                   ["#FFF", "#FFB", "#FF7", "#FF0", ],
                   ["#FFF", "#BBF", "#77F", "#00F", ],
                   ["#FFF", "#BFF", "#8DD", "#0BB", ],
                  ]; -->
<div id="accordion" class="ui-accordion-header">
<h2>EEB Expected Learning Outcomes</h2>

<div id="locontent">
<h3 >Outcome 1 Demonstrate an understanding of ecology and evolutionary biology</h3>
<ol>
  <li> <span class="keycode"  style="background: #FAA;" ></span>
    Awareness of basic and key questions and theories in EEB.
  </li>
  <li> <span class="keycode"  style="background: #F77;" ></span>
    Understanding of basic and key questions and theories in EEB
  </li>
  <li> <span class="keycode"  style="background: #F00;" ></span>
    Application and synthesis of basic and key questions and theories in EEB 
  </li>
</ol>
<p> KU institution-level learning goals roughly correspond or match:
<ul>
  <li><b>Analytical reasoning</b></li>
</ul>
</p>
<hr />
<h3>Outcome 2 Demonstrate an understanding of best research practices & ethics in EEB </h3>
<ol>
  <li> <span class="keycode"  style="background: #FFB;" ></span>
    Awareness of basic research ethics and professional codes of conduct.
  </li>
  <li> <span class="keycode"  style="background: #FF7;" ></span>
    Development of key analytical skills such as statistics
  </li>
  <li> <span class="keycode"  style="background: #FF0;" ></span>
    Application of best research practices and ethics
  </li>
</ol>
<p> KU institution-level learning goals roughly correspond or match:
<ul>
  <li><b>Analytical reasoning</b></li>
  <li><b>Ethical and professional responsibility </b></li>
</ul>
</p>
<hr />
<h3>Outcome 3 Demonstrate the ability to perform independent research in ecology and/or evolutionary biology</h3>
<ol>
  <li> <span class="keycode"  style="background: #BBF;" ></span>
    Outlining a research idea or topic, including proposed methods 
  </li>
  <li> <span class="keycode"  style="background: #77F;" ></span>
    Execution and justification of a research proposal on a novel question in EEB, including its methodology and hypothesized outcomes
  </li>
  <li> <span class="keycode"  style="background: #00F;" ></span>
    Completion of dissertation research
  </li>
</ol>
<p> KU institution-level learning goals roughly correspond or match:
<ul>
  <li><b>Creative inquiry and discovery </b></li>
</ul>
</p>
<hr />
<h3>Outcome 4 Demonstrate the ability to disseminate research findings </h3>
<ol>
  <li> <span class="keycode"  style="background: #BFF;" ></span>
    Ability to discuss research and primarily literature 
  </li>
  <li> <span class="keycode"  style="background: #8DD;" ></span>
    Ability to articulate original research questions, methods, and approaches.  
  </li>
  <li> <span class="keycode"  style="background: #0BB;" ></span>
    Synthesize and communicate the findings of original research to a research audience 
  </li>
</ol>
<p> KU institution-level learning goals roughly correspond or match:
<ul>
  <li><b>Effective communication</b></li>
</ul>
</p>
</div>
</div>

<hr />
<h2>EEB PhD Curriculum Map</h2>
<p><i>Note: This is still a work-in-progress!</i> The map will be interactive, allowing placement of classes and events onto a grid representing the timeline. Feel free to send comments/suggestions to <a href="mailto:mtholder@ku.edu">mtholder@ku.edu</a></p>
<div>
  <div id="canvas"/>
</div>

<script>
////////////////////////////////////////////////////////////////////////
// HARD-CODED CONSTANTS
var CANVAS_WIDTH;
var CANVAS_HEIGHT;
var TIMELINE_X;
var TIMELINE_Y;
var TL_TEXT_PUSH_Y;
var TIMELINE_WIDTH;
var TIMELINE_TEXT_WIDTH;
var MID_TIMELINE_X;
var EEB_X;
var EEB_Y;
var EEB_TEXT_PUSH_Y;
var EEB_WIDTH;
var EEB_TEXT_WIDTH;
var MID_EEB_X;
var CLASS_WIDTH;
var CLASS_X;
var CLASS_Y;
var CLASS_TEXT_PUSH_Y;
var CLASS_TEXT_WIDTH;
var MID_CLASS_X;
var FIRST_MONTH_Y;
var FIRST_SEMESTER_Y;
var SEM_GAP_Y;
var FIRST_FALL_Y;
var FIRST_SPRING_Y;
var THIRD_SEM_Y;
var START_THIRD_SEMESTER_Y;
var BEFORE_ORALS_Y;
var CANDIDACY_Y;
var FOURTH_SEM_Y;
var EARLY_FOURTH_SEMESTER_Y;
var AFTER_CANDIDACY_Y;
var THIRD_YEAR_Y;
var FOURTH_YEAR_Y;
var EARLY_FIFTH_SEMESTER_Y;
var DEFENSE_Y;
var BEFORE_DEFENSE_Y;
var UNTIMED_EEB_Y;
var UNTIMED_CLASS_Y;
var timeline_y;

///////////////////////////////////////////////////////////////////////////
var lo_visible = true;
var canvas_root;

var class_by_sem = [];
var untimed_event_list = [];
var untimed_class_list = [];
// If you change this, change the key, too!
var outcome_col = [["#FFF", "#FAA", "#F77", "#F00", ],
                   ["#FFF", "#FFB", "#FF7", "#FF0", ],
                   ["#FFF", "#BBF", "#77F", "#00F", ],
                   ["#FFF", "#BFF", "#8DD", "#0BB", ],
                  ];
var classFill = "#DDD";
var gID = 1;
var non_class_events = [];
var classes = [];
var timeline_objs = [{
    "time_offset": 0,
    "text": "1st month"
  }, {
    "time_offset": 1,
    "text": "1st Fall"
  }, {
    "time_offset": 2,
    "text": "1st Spring"
  }, {
    "time_offset": 3,
    "text": "3rd Semester"
  },{
    "time_offset": 4,
    "text": "4th Semester"
  }
];

///////////////////////////////////////////////////////////////////////////
var set_constants = function(lev) {
  CANVAS_WIDTH = 1500;
  CANVAS_HEIGHT = 1520;

  TIMELINE_X = 5;
  TIMELINE_Y = 5;
  TL_TEXT_PUSH_Y = 10;
  TIMELINE_WIDTH = 100;
  TIMELINE_TEXT_WIDTH = TIMELINE_WIDTH - 10;
  MID_TIMELINE_X = TIMELINE_X  + (TIMELINE_WIDTH/2);

  EEB_X = TIMELINE_X + TIMELINE_WIDTH + 40;
  EEB_Y = TIMELINE_Y;
  EEB_TEXT_PUSH_Y = TL_TEXT_PUSH_Y;
  EEB_WIDTH = 180;
  EEB_TEXT_WIDTH = EEB_WIDTH - 10;
  MID_EEB_X = EEB_X  + (EEB_WIDTH/2);

  CLASS_WIDTH = 2* EEB_WIDTH;
  CLASS_X = EEB_X + (EEB_WIDTH + CLASS_WIDTH)/2 ;
  CLASS_Y = EEB_Y;
  CLASS_TEXT_PUSH_Y = EEB_TEXT_PUSH_Y + 4;
  CLASS_TEXT_WIDTH = CLASS_WIDTH - 10;
  MID_CLASS_X = CLASS_X  + (CLASS_WIDTH/2);

  FIRST_MONTH_Y = TIMELINE_Y + 20;
  FIRST_SEMESTER_Y = FIRST_MONTH_Y + 20;
  SEM_GAP_Y = 50;
  FIRST_FALL_Y = FIRST_SEMESTER_Y;
  FIRST_SPRING_Y = FIRST_FALL_Y + SEM_GAP_Y;
  THIRD_SEM_Y = FIRST_SPRING_Y + SEM_GAP_Y;
  START_THIRD_SEMESTER_Y = THIRD_SEM_Y - 40;
  BEFORE_ORALS_Y = THIRD_SEM_Y - 20;
  CANDIDACY_Y = THIRD_SEM_Y + 15;
  FOURTH_SEM_Y = THIRD_SEM_Y + SEM_GAP_Y;
  EARLY_FOURTH_SEMESTER_Y = FOURTH_SEM_Y - 20;
  AFTER_CANDIDACY_Y = FOURTH_SEM_Y + 25;
  THIRD_YEAR_Y = FOURTH_SEM_Y + SEM_GAP_Y;
  FOURTH_YEAR_Y = THIRD_YEAR_Y + 2*SEM_GAP_Y;
  EARLY_FIFTH_SEMESTER_Y = THIRD_YEAR_Y - 20;
  DEFENSE_Y = 500;
  BEFORE_DEFENSE_Y = DEFENSE_Y - 20;
  UNTIMED_EEB_Y = DEFENSE_Y + 20;
  UNTIMED_CLASS_Y = UNTIMED_EEB_Y + 20;
  timeline_y = [FIRST_MONTH_Y, FIRST_FALL_Y, FIRST_SPRING_Y, THIRD_SEM_Y, FOURTH_SEM_Y];
}

function isInteger(value) {
  return /^\d+$/.test(value);
}

var parse_timing = function(ts) {
  var name_to_num = {
    "AFTER_CANDIDACY": AFTER_CANDIDACY_Y,
    "BEFORE_ORALS": BEFORE_ORALS_Y,
    "DEFENSE_DATE": DEFENSE_Y,
    "FIFTH_SEMESTER": THIRD_YEAR_Y,
    "FIRST_FALL": FIRST_FALL_Y,
    "FIRST_MONTH": FIRST_MONTH_Y,
    "FIRST_SPRING": FIRST_SPRING_Y,
    "FOURTH_SEMESTER": FOURTH_SEM_Y,
    "THIRD_SEMESTER": THIRD_SEM_Y,
    "START_THIRD_SEMESTER": START_THIRD_SEMESTER_Y,
    "EARLY_FOURTH_SEMESTER": EARLY_FOURTH_SEMESTER_Y,
    "EARLY_FIFTH_SEMESTER": EARLY_FIFTH_SEMESTER_Y,
    "BEFORE_DEFENSE_DATE": BEFORE_DEFENSE_Y,
  }
  if (isInteger(ts)) {
    return parseInt(ts, 10);
  }
  if (ts in name_to_num) {
    return name_to_num[ts];
  }
  throw new Error("Key " + ts + " not recognized as a time.");
}

var do_parse_all_data = function(event_list) {
  non_class_events.length = 0;
  classes.length = 0;
  var unc_el;
  for (unc_el of event_list) {
    if (unc_el.timing) {
      unc_el.timing = parse_timing(unc_el.timing)
    }
    if (unc_el.type == "class") {
      classes[classes.length] = unc_el;
    } else if (unc_el.type == "event") {
      non_class_events[non_class_events.length] = unc_el;
    } else {
      throw new Error("event/class object type should be class or event")
    }
  }
};

var add_timeline_text = function(y, text_val) {
  canvas_root.append('text')
    .attr("x", MID_TIMELINE_X)
    .attr("y",  y + TL_TEXT_PUSH_Y)
    .attr("class", "timelinepoint")
    .text(text_val)
      .attr("text-anchor", "middle");
};

var add_timeline_obj = function(o) {
  var y_var = timeline_y[o.time_offset];
  add_timeline_text(y_var, o.text);
};

var do_draw_timeline = function() {
  canvas_root.append("rect")
    .attr('x', TIMELINE_X)
    .attr('y', TIMELINE_Y)
    .attr('height', CANDIDACY_Y - TIMELINE_Y)
    .attr('width', TIMELINE_WIDTH)
    .attr('fill', "white")
    .attr('stroke', "black");
  canvas_root.append('text')
    .attr("x", MID_TIMELINE_X)
    .attr("y", TIMELINE_Y + 15)
    .attr("font-size", "10pt")
    .attr("fill", "grey")
    .attr("text-anchor", "middle")
    .text("pre-candidacy");
  canvas_root.append("rect")
    .attr('x', TIMELINE_X)
    .attr('y', CANDIDACY_Y)
    .attr('height', DEFENSE_Y - CANDIDACY_Y)
    .attr('width', TIMELINE_WIDTH)
    .attr('fill', "white")
    .attr('stroke', "black");
  canvas_root.append('text')
    .attr("x", MID_TIMELINE_X)
    .attr( "y", DEFENSE_Y - 15)
    .attr("font-size", "10pt")
    .attr( "fill", "grey")
    .attr("text-anchor", "middle")
    .text("candidacy");
  var o;
  for (o of timeline_objs) {
    add_timeline_obj(o);
  }
};

var add_eeb_text = function(group_el, y, text_val, lg_vec) {
  canvas_root.append('text')
    .attr("x", MID_EEB_X)
    .attr("y", y + EEB_TEXT_PUSH_Y)
    .attr("class", "eebevent")
    .text(text_val)
      .attr("text-anchor", "middle");
};


var add_outcomes_boxes = function(group_el, o, x, y, height, full_width) {
  var outcomes = o.outcomes;
  var ov;
  var oid = 0;
  var width = full_width/4;
  for (ov of outcomes) {
    group_el.append('rect')
      .attr("x", x + width*oid)
      .attr("y", y)
      .attr("height", height)
      .attr("width", width)
      .attr("fill", outcome_col[oid][ov]);
    oid += 1;
  }
};

var display_eeb_obj = function(group_el, o, x, y, width, height) {
  group_el.append('rect')
    .attr("x", x)
    .attr("y", y)
    .attr("height", height)
    .attr("width", width)
    .attr("fill", "transparent")
    .attr("stroke", "#000");
  var half_height = height/2;
  add_outcomes_boxes(group_el, o, x+1, y + half_height + 2, half_height - 3, width-2);
};


var add_eeb_obj = function(o) {
  var y = o.timing - 2;
  var x = MID_EEB_X - (EEB_WIDTH/2) + 5;
  var width = EEB_WIDTH;
  var height = (SEM_GAP_Y - 10)/2;
  var group_el = canvas_root.append("g");
  display_eeb_obj(group_el, o, x, y, width, height);
  add_eeb_text(group_el, o.timing, o.title, o.outcomes);
};

var add_untimed_eeb_obj = function(o) {
  var x = TIMELINE_X + EEB_WIDTH*(untimed_event_list.length % 4);
  var row_ind = Math.floor(untimed_event_list.length / 4);
  var y = UNTIMED_EEB_Y + SEM_GAP_Y*(1+row_ind);
  UNTIMED_CLASS_Y = y + SEM_GAP_Y;
  var width = EEB_WIDTH;
  var height = (SEM_GAP_Y - 10)/2;

  var group_el = canvas_root.append("g");
  display_eeb_obj(group_el, o, x, y, width, height);
  //add_eeb_text(y, o.title, o.outcomes);
  //console.log("x=" + x + ", y=" + y + ", text=" +o.title + "\n");
  group_el.append('text')
    .attr("x", TIMELINE_X + EEB_WIDTH*(untimed_event_list.length % 4) + EEB_WIDTH/2)
    .attr("y", y + 10)
    .attr("class", "eebevent")
    .text(o.title).attr("text-anchor", "middle");
  untimed_event_list[untimed_event_list.length] = o;
  
};

var display_class_obj = function(group_el, o, x, y, width, height) {
  group_el.append('rect')
    .attr("x", x)
    .attr("y", y)
    .attr("height", height)
    .attr("width", width)
    .attr("fill", classFill)
    .attr("stroke", "#000");
  var half_height = height/2;
  add_outcomes_boxes(group_el, o, x + 2, y + half_height + 2, half_height - 4, width -4);
};


var dragcontainer = d3.drag()
  .on("drag", function(event, d, i) {
    d3.select(this).attr("transform", "translate(" + (d.x = event.x) + "," + (d.y = event.y) + ")");
  });

var add_untimed_class_obj = function(o) {
  var x = TIMELINE_X + CLASS_WIDTH*(untimed_class_list.length % 4);
  var row_ind = Math.floor(untimed_class_list.length / 4);
  var y = UNTIMED_CLASS_Y - 40 + SEM_GAP_Y*(1+row_ind);
  var width = CLASS_WIDTH;
  var height = (SEM_GAP_Y - 10);

  var group_id = "group" + gID;
  gID += 1;
  var group_el = canvas_root.append("g")
    .attr("id", group_id)
    .attr("x", 0)
    .attr("y", 0);
  display_class_obj(group_el, o, x, y, width, height);
  //add_eeb_text(y, o.title, o.outcomes);
  //console.log("x=" + x + ", y=" + y + ", text=" +o.title + "\n");
  group_el.append('text')
    .attr("x", TIMELINE_X + CLASS_WIDTH*(untimed_class_list.length % 4) + CLASS_WIDTH/2)
    .attr("y", y + 11)
    .attr("class", "eebevent")
    .text(o.title).attr("text-anchor", "middle");
  untimed_class_list[untimed_class_list.length] = o;

  d3.select("#" + group_id).datum({"x": 0, "y": 0}).call(dragcontainer);
};

var do_draw_eeb_events = function() {
  canvas_root.append('text')
    .attr("x", MID_EEB_X)
    .attr("y", EEB_Y + 15)
    .attr("font-size", "10pt")
    .attr("fill", "grey")
    .attr("text-anchor", "middle")
    .text("Non-class events");

  var o;
  for (o of non_class_events) {
    if (o.timing !== undefined) {
      add_eeb_obj(o);
    } else {
      add_untimed_eeb_obj(o);
    }
  }
}


var add_class_obj = function(o) {
  var semester_num = o.timing;
  while (semester_num >= class_by_sem.length) {
    class_by_sem[class_by_sem.length] = [];
  }
  var rel_sem = class_by_sem[semester_num];
  var x_offset = CLASS_WIDTH * rel_sem.length;
  rel_sem[rel_sem.length] = o;
  var sem_index = semester_num - 1;
  var y = sem_index * SEM_GAP_Y + FIRST_SEMESTER_Y;
  var x = MID_CLASS_X + x_offset - (CLASS_WIDTH/2) + 5;
  var height = SEM_GAP_Y - 10;
  var width = CLASS_WIDTH - 10;
  var group_id = "group" + gID;
  gID += 1;
  var group_el = canvas_root.append("g")
    .attr("id", group_id)
    .attr("x", 0)
    .attr("y", 0);
  display_class_obj(group_el, o, x, y, width, height);
  console.log(o.title + " at (" + x + ", " + y + ")")
  group_el.append('text')
    .attr("x", MID_CLASS_X + x_offset)
    .attr("y", y + CLASS_TEXT_PUSH_Y)
    .attr("class", "eebclass")
    .text(o.title)
      .attr("text-anchor", "middle");
  d3.select("#" + group_id).datum({"x": 0, "y": 0}).call(dragcontainer);
}

var do_draw_classes = function() {
  canvas_root.append('text')
    .attr("x", MID_CLASS_X)
    .attr("y", CLASS_Y + 15)
    .attr("font-size", "10pt")
    .attr("fill", "grey")
    .attr("text-anchor", "middle")
    .text("Classes");

  var o;
  for (o of classes) {
    if (o.timing !== undefined) {
      add_class_obj(o);
    } else {
      add_untimed_class_obj(o);
    }
  }
}

var fill_all_events = function(lev) {
  var all_events = []
  if (lev == "mant") {
    all_events = in_ma_nonthesis.concat(in_all_levels);
  } else if (lev == "mat") {
    all_events = in_ma_thesis.concat(in_all_levels);
  } else if (lev == "phd") {
    all_events = in_phd.concat(in_all_levels);
  } else {
    console.log("No events shown because show_level is set to " + lev);
  }
  return all_events;
}

var main_func = function(lev) {
  show_level = lev;
  set_constants(lev);
  canvas_root = d3.select('#canvas').append('svg')
    .attr('width', CANVAS_WIDTH)
    .attr('height', CANVAS_HEIGHT)
    .style('background', 'white');
  var all_events = fill_all_events(lev);
  do_parse_all_data(all_events);
  do_draw_timeline(lev);
  do_draw_eeb_events();
  do_draw_classes();
}

$(document).ready(function() {
  main_func("phd");
});
</script>

</body>
</html>